<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Project Chimera: The Sentient Core</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        :root { --color-bg: #000; --color-text: #ddd; }
        body { font-family: 'Share Tech Mono', monospace; background-color: var(--color-bg); color: var(--color-text); margin: 0; overflow: hidden; text-align: center; }
        #core-canvas { position: fixed; top: 0; left: 0; z-index: 1; }
        #ui-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2; padding: 2em; box-sizing: border-box; background: radial-gradient(circle, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.8) 80%); }
        #prompt-text { font-size: 1.5em; margin-bottom: 2em; max-width: 600px; line-height: 1.6; animation: fadeIn 2s; }
        #choices-container { display: flex; justify-content: center; gap: 2em; animation: fadeIn 2s 1s backwards; }
        .color-choice { width: 80px; height: 80px; border-radius: 50%; cursor: pointer; border: 3px solid #fff; transition: all 0.3s ease; }
        .color-choice:hover { transform: scale(1.1); box-shadow: 0 0 20px var(--shadow-color); }
        #choice-red { background-color: #ff4136; --shadow-color: #ff4136; }
        #choice-blue { background-color: #0074d9; --shadow-color: #0074d9; }
        #choice-yellow { background-color: #ffdc00; --shadow-color: #ffdc00; }
        #feedback-text { position: absolute; bottom: 5%; font-size: 1em; opacity: 0; transition: opacity 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <canvas id="core-canvas"></canvas>
    <div id="ui-overlay">
        <div id="prompt-text">¿Qué cualidad define mejor la conciencia?</div>
        <div id="choices-container">
            <div class="color-choice" id="choice-red" data-color="red" title="Pasión / Caos"></div>
            <div class="color-choice" id="choice-blue" data-color="blue" title="Lógica / Orden"></div>
            <div class="color-choice" id="choice-yellow" data-color="yellow" title="Creatividad / Curiosidad"></div>
        </div>
        <div id="feedback-text"></div>
    </div>

    <script>
        const canvas = document.getElementById('core-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- NÚCLEO GRÁFICO ---
        let hue = 200; let pulsation = 0;
        function animateCore() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            pulsation += 0.02;
            const radius = 50 + Math.sin(pulsation) * 10;
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, radius, 0, Math.PI * 2);
            ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
            ctx.shadowColor = `hsl(${hue}, 100%, 50%)`;
            ctx.shadowBlur = 30;
            ctx.fill();
            ctx.shadowBlur = 0;
            requestAnimationFrame(animateCore);
        }
        animateCore();

        // --- LÓGICA DE INTERACCIÓN ---
        const feedbackText = document.getElementById('feedback-text');
        document.querySelectorAll('.color-choice').forEach(button => {
            button.addEventListener('click', async () => {
                const chosenColor = button.dataset.color;
                
                // Muestra feedback visual inmediato
                feedbackText.textContent = `Procesando ${chosenColor}...`;
                feedbackText.style.opacity = '1';
                
                // Cambia el color del núcleo
                if (chosenColor === 'red') hue = 0;
                if (chosenColor === 'blue') hue = 220;
                if (chosenColor === 'yellow') hue = 60;

                try {
                    // ¡Aquí es donde le hablamos a la API que creamos!
                    const response = await fetch('/api/interact', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ color: chosenColor })
                    });

                    if (!response.ok) {
                        throw new Error(`Error del servidor: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    feedbackText.textContent = result.message; // Muestra el mensaje de éxito de la API

                } catch (error) {
                    console.error('Error al interactuar:', error);
                    feedbackText.textContent = 'Error de conexión con la memoria.';
                }

                setTimeout(() => { feedbackText.style.opacity = '0'; }, 2000);
            });
        });
    </script>
</body>
</html>